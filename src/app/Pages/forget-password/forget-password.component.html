<section
  class="min-h-screen flex justify-center items-center bg-gradient-to-b from-white via-gray-50 to-green-50 py-10 px-4"
>
  <div
    class="w-full md:max-w-[60%] bg-white border border-green-100 rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-500 p-8"
  >
    <h2 class="text-3xl font-bold text-green-600 mb-6 text-center">
      {{ 'RESET_PASSWORD.TITLE' | translate }}
    </h2>

    <!-- رسائل الخطأ / النجاح -->
    @if (errorMsg) {
      <div
        class="mb-4 p-3 rounded-lg text-sm text-red-800 bg-red-100 border border-red-200"
      >
        {{ errorMsg }}
      </div>
    }
    @if (isSuccess) {
      <div
        class="mb-4 p-3 rounded-lg text-sm text-green-800 bg-green-100 border border-green-200"
      >
        {{ isSuccess }}
      </div>
    }

    <!-- الخطوة 1: التحقق من البريد الإلكتروني -->
    @if (step==1) {
      <form
        [formGroup]="verifyEmail"
        (ngSubmit)="submitVerifyEmail()"
        class="space-y-4 mb-6"
      >
        <label class="block text-sm font-medium text-gray-700">
          {{ 'RESET_PASSWORD.EMAIL_LABEL' | translate }}
        </label>
        <input
          formControlName="email"
          type="email"
          [placeholder]="'RESET_PASSWORD.EMAIL_PLACEHOLDER' | translate"
          class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-400 focus:outline-none"
        />

        @if (verifyEmail.get('email')?.invalid && verifyEmail.get('email')?.touched) {
          <div
            class="flex p-4 mt-3 text-sm text-red-800 rounded-lg bg-red-50"
            role="alert"
          >
            <ul class="list-disc list-inside">
              @if (verifyEmail.get('email')?.errors?.['required']) {
                <li>{{ 'RESET_PASSWORD.ERROR_REQUIRED_EMAIL' | translate }}</li>
              }
              @if (verifyEmail.get('email')?.errors?.['email']) {
                <li>{{ 'RESET_PASSWORD.ERROR_INVALID_EMAIL' | translate }}</li>
              }
            </ul>
          </div>
        }

        <button
          type="submit"
          [disabled]="verifyEmail.invalid || isLoading"
          class="w-full py-2 rounded-lg shadow transition-all duration-300
                 text-white font-semibold
                 bg-green-500 hover:bg-green-600
                 disabled:bg-gray-300 disabled:cursor-not-allowed disabled:shadow-none"
        >
          @if (isLoading) {
            <span>{{ 'RESET_PASSWORD.SENDING' | translate }} <i class="fas fa-spinner fa-spin"></i></span>
          } @else {
            <span>{{ 'RESET_PASSWORD.SEND_CODE' | translate }}</span>
          }
        </button>
      </form>
    }

    <!-- الخطوة 2: التحقق من الكود -->
    @if (step==2) {
      <form
        [formGroup]="verifyCode"
        (ngSubmit)="submitVerifyCode()"
        class="space-y-4 mb-6"
      >
        <label class="block text-sm font-medium text-gray-700">
          {{ 'RESET_PASSWORD.VERIFY_CODE' | translate }}
        </label>
        <input
          formControlName="resetCode"
          type="text"
          [placeholder]="'RESET_PASSWORD.CODE_PLACEHOLDER' | translate"
          maxlength="6"
          class="w-full border border-gray-300 rounded-lg px-4 py-2 text-center tracking-widest focus:ring-2 focus:ring-green-400 focus:outline-none"
        />

        @if (verifyCode.get('resetCode')?.invalid && verifyCode.get('resetCode')?.touched) {
          <div
            class="flex p-4 mt-3 text-sm text-red-800 rounded-lg bg-red-50"
            role="alert"
          >
            <ul class="list-disc list-inside">
              @if (verifyCode.get('resetCode')?.errors?.['required']) {
                <li>{{ 'RESET_PASSWORD.ERROR_REQUIRED_CODE' | translate }}</li>
              }
              @if (verifyCode.get('resetCode')?.errors?.['pattern']) {
                <li>{{ 'RESET_PASSWORD.ERROR_INVALID_CODE' | translate }}</li>
              }
            </ul>
          </div>
        }

        <button
          type="submit"
          [disabled]="verifyCode.invalid || isLoading"
          class="w-full py-2 rounded-lg shadow transition-all duration-300
                 text-white font-semibold
                 bg-green-500 hover:bg-green-600
                 disabled:bg-gray-300 disabled:cursor-not-allowed disabled:shadow-none"
        >
          @if (isLoading) {
            <span>{{ 'RESET_PASSWORD.VERIFYING' | translate }} <i class="fas fa-spinner fa-spin"></i></span>
          } @else {
            <span>{{ 'RESET_PASSWORD.VERIFY_BTN' | translate }}</span>
          }
        </button>
      </form>
    }

    <!-- الخطوة 3: تعيين كلمة مرور جديدة -->
    @if (step==3) {
      <form
        [formGroup]="resetPassword"
        (ngSubmit)="submitVerifyPassword()"
        class="space-y-4"
      >
        <label class="block text-sm font-medium text-gray-700">
          {{ 'RESET_PASSWORD.NEW_PASSWORD_LABEL' | translate }}
        </label>

        <div
          class="flex items-center border border-gray-300 rounded-lg px-4 focus-within:ring-2 focus-within:ring-green-400"
        >
         <input
  formControlName="newPassword"
  [type]="showPassword ? 'text' : 'password'"
  [placeholder]="'RESET_PASSWORD.NEW_PASSWORD_PLACEHOLDER' | translate"
  class="flex-1 py-2 focus:outline-none border-none bg-transparent"
/>


          <button
            type="button"
            (click)="togglePassword()"
            class="flex items-center justify-center text-gray-500 hover:text-green-600 transition"
          >
            <i [ngClass]="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
          </button>
        </div>

        @if (resetPassword.get('newPassword')?.invalid && resetPassword.get('newPassword')?.touched) {
          <div
            class="flex p-4 mt-3 text-sm text-red-800 rounded-lg bg-red-50"
            role="alert"
          >
            <ul class="list-disc list-inside">
              @if (resetPassword.get('newPassword')?.errors?.['required']) {
                <li>{{ 'RESET_PASSWORD.ERROR_REQUIRED_PASSWORD' | translate }}</li>
              }
              @if (resetPassword.get('newPassword')?.errors?.['pattern']) {
                <li>{{ 'RESET_PASSWORD.ERROR_INVALID_PASSWORD' | translate }}</li>
              }
            </ul>
          </div>
        }

        <button
          type="submit"
          [disabled]="resetPassword.invalid || isLoading"
          class="w-full py-2 rounded-lg shadow transition-all duration-300
                 text-white font-semibold
                 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700
                 disabled:bg-gray-300 disabled:cursor-not-allowed disabled:shadow-none"
        >
          @if (isLoading) {
            <span>{{ 'RESET_PASSWORD.RESETTING' | translate }} <i class="fas fa-spinner fa-spin"></i></span>
          } @else {
            <span>{{ 'RESET_PASSWORD.RESET_BTN' | translate }}</span>
          }
        </button>
      </form>
    }
  </div>
</section>
